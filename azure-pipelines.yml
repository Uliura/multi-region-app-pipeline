---
trigger: none

variables:
  - group: Terraform-Variable-Group

stages:
    - stage: terraform
      displayName: Build infrastructure
      jobs:
      - job: Terraform_Plan
        displayName: Terraform Init, Plan & Apply
        pool:
          name: Azure Pipelines
        steps:
          - template: terraform.yml
              
    - stage: BuildApp
      displayName: Build webapp
      jobs:
      - job: buildapp
        displayName: build app
        pool:
          name: Azure Pipelines
        steps:
          - template: buildapp.yml

    - stage: DeployApp
      displayName: Deploy app
      jobs:
      - job: Deployapp
        displayName: Deploy app
        pool:
          name: Azure Pipelines
        steps:
          - template: deploy.yml